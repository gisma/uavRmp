<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mission Planning on basis of QGroundcontrol â€¢ uavRmp</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Mission Planning on basis of QGroundcontrol">
<meta property="og:description" content="uavRmp">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">uavRmp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/uavRmp_1.html">Unmanned Aerial Vehicle R based Mission Planning</a>
    </li>
    <li>
      <a href="../articles/uavRmp_2.html">Mission Planning on basis of QGroundcontrol</a>
    </li>
    <li>
      <a href="../articles/uavRmp_3.html">Export to Litchi</a>
    </li>
    <li>
      <a href="../articles/uavRmp_4.html">Basic Field Guide</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/gisma/uavRmp/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Mission Planning on basis of QGroundcontrol</h1>
                        <h4 data-toc-skip class="author">Chris
Reudenbach</h4>
            
            <h4 data-toc-skip class="date">2023-03-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/gisma/uavRmp/blob/HEAD/vignettes/uavRmp_2.Rmd" class="external-link"><code>vignettes/uavRmp_2.Rmd</code></a></small>
      <div class="hidden name"><code>uavRmp_2.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="planning-the-flight-task-with-the-missionplanner-or-qgroundcontrol-survey-feature">Planning the Flight task with the Missionplanner or Qgroundcontrol
survey feature<a class="anchor" aria-label="anchor" href="#planning-the-flight-task-with-the-missionplanner-or-qgroundcontrol-survey-feature"></a>
</h2>
<p>We want to plan a flight in a structured terrain in the upper
Lahn-valley. Start the QGroundcontrol and navigate to Mission tab and
open Pattern-&gt;Survey. Start digitizing a pattern as you want and also
fill in the values on the right sided menus for camera angel overlap and
so on. <img src="qcmission.png" alt="The first autonomous complex mission planned with QGroundcontrol"></p>
<p>Save this at an appropriate folder. To use this planning file you
have to set in <code>makeAP</code> the switch:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">useMP</span> <span class="op">=</span> <span class="cn">TRUE</span></span></code></pre></div>
<p>The planning with QGroundControl is much more powerful and
comfortable than the simple planning with uavRmp. However, if you want
to use some features like near-surface flights or more important a
survey planning for DJI/Litchi, some parameters have to be set very
carefully to make this export usable. Especially the Litchi export needs
some care. Not all parameters from the Qgroundcontrol settings are taken
over. Crucial is: * Set correct camera parameterization * choose
<code>calc above terrain</code> and a reasonable <code>tolerance</code>
filter (&lt;=5)</p>
<p>With the parameters: <code>horizonFilter</code>,
<code>followSurfaceRes</code>, <code>altFilter</code> the behavior of
the smoothing of the flight curve is set. It makes sense to keep the
values the same at first. If the <code>followSurfaceRes</code> is set
bigger than the distance of the single flight lines it will be
automatically reduced.</p>
<p>By default <code>noFiles</code> is set to one. Due to the modern UAVs
it is strongly recommended to keep it so. If you want to calculate
single tasks you may set it to the number you need. However the task
splitting is switched off which is useful for the modern DJI UAVs
because you can use every waypoint in as a manual starting point for the
continuation of the task after a battery change.</p>
<p><strong>Note:</strong> For a problem-free terrain contour flight it
is obligatory to set the parameter
<code>above_ground = FALSE</code>.</p>
<p>The example below shows a meaningful example for an Air 2S DJI and a
30m ASL flight over beech wood with default settings.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demFn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"mrbiko.tif"</span>, package <span class="op">=</span> <span class="st">"uavRmp"</span><span class="op">)</span></span>
<span><span class="va">tutorial_flightArea</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"tutdata_qgc_survey30m.plan"</span>, package <span class="op">=</span> <span class="st">"uavRmp"</span><span class="op">)</span></span>
<span><span class="va">fp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeAP.html">makeAP</a></span><span class="op">(</span>projectDir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>             surveyArea <span class="op">=</span> <span class="va">tutorial_flightArea</span>,</span>
<span>             useMP <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             followSurface <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             above_ground <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             demFn <span class="op">=</span> <span class="va">demFn</span>,</span>
<span>             uavType <span class="op">=</span> <span class="st">"dji_csv"</span> </span>
<span>             <span class="op">)</span></span></code></pre></div>
<p>The result looks like this in Litchi.</p>
<p><img src="qcmissionb15.png"></p>
<p>It is easy to see that there are major errors in the
transmission.</p>
<p>These resuls from the (a) a complex outer hull of the structure and
that b) the turning points which are necessary to maintain the lateral
overlap are filtered out in the DSM analysis. There are some simple ways
to overcome this structural problem:</p>
<ol style="list-style-type: decimal">
<li>increase the distance of synthetic waypoints:
<code>followSurfaceRes = 2</code>
</li>
<li>in doubt choose the same value for the argument that controls the
the rolling filter.: <code>horizonFilter = 2</code>
</li>
<li>adapt the number of waypoints to your needs e.g..:
<code>altFilter = 5.0</code>
</li>
<li>increase the argument buf_mult to e.g.:
<code>buf_mult = 3</code>
</li>
</ol>
<p>So adding a extended turning point tolerance (<code>mult-buf</code>)
the results looks like below:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demFn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"mrbiko.tif"</span>, package <span class="op">=</span> <span class="st">"uavRmp"</span><span class="op">)</span></span>
<span><span class="va">tutorial_flightArea</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"tutdata_qgc_survey30m.plan"</span>, package <span class="op">=</span> <span class="st">"uavRmp"</span><span class="op">)</span></span>
<span><span class="va">fp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeAP.html">makeAP</a></span><span class="op">(</span>projectDir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>             surveyArea <span class="op">=</span> <span class="va">tutorial_flightArea</span>,</span>
<span>             useMP <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             followSurface <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             buf_mult <span class="op">=</span> <span class="fl">3</span>,</span>
<span>             above_ground <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             demFn <span class="op">=</span> <span class="va">demFn</span>,</span>
<span>             uavType <span class="op">=</span> <span class="st">"dji_csv"</span> </span>
<span>             <span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="qcmissionb15_detail.png" alt=""><p class="caption">Litchi result</p>
</div>
<p>Modifying the terrain following control arguments
<code>followSundrfaceRes</code>, <code>horizonFilter</code> and
<code>altFilter</code> will yield in a much more detailed control
file:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demFn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"mrbiko.tif"</span>, package <span class="op">=</span> <span class="st">"uavRmp"</span><span class="op">)</span></span>
<span><span class="va">tutorial_flightArea</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"tutdata_qgc_survey30m.plan"</span>, package <span class="op">=</span> <span class="st">"uavRmp"</span><span class="op">)</span></span>
<span><span class="va">fp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeAP.html">makeAP</a></span><span class="op">(</span>projectDir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>             surveyArea <span class="op">=</span> <span class="va">tutorial_flightArea</span>,</span>
<span>             useMP <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             followSurface <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             buf_mult <span class="op">=</span> <span class="fl">3</span>,</span>
<span>             followSurfaceRes <span class="op">=</span> <span class="fl">2</span>, </span>
<span>             horizonFilter <span class="op">=</span> <span class="fl">2</span>, </span>
<span>             altFilter <span class="op">=</span> <span class="fl">5</span>,</span>
<span>             above_ground <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             demFn <span class="op">=</span> <span class="va">demFn</span>,</span>
<span>             uavType <span class="op">=</span> <span class="st">"dji_csv"</span> </span>
<span>             <span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="qcmissionb16.png" alt=""><p class="caption">Litchi result</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Chris Reudenbach.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
