!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).geojsonvt=e()}}(function(){return function e(t,n,o){function r(s,u){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!u&&l)return l(s,!0);if(i)return i(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var a=n[s]={exports:{}};t[s][0].call(a.exports,function(e){var n=t[s][1][e];return r(n||e)},a,a.exports,e,t,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(e,t,n){"use strict";function o(e,t,n,o){for(var r=[],i=0;i<e.length;i++){var s=e[i],u=s[o];u>=t&&u<=n&&r.push(s)}return r}function r(e,t,n,o,r,s){for(var u=[],l=0;l<e.length;l++){var f,a,h=0,p=0,c=null,g=e[l],m=g.area,d=g.dist,v=g.length,y=[];for(a=0;a<v-1;a++)f=c||g[a],c=g[a+1],h=p||f[o],p=c[o],h<t?p>n?(y.push(r(f,c,t),r(f,c,n)),s||(y=i(u,y,m,d))):p>=t&&y.push(r(f,c,t)):h>n?p<t?(y.push(r(f,c,n),r(f,c,t)),s||(y=i(u,y,m,d))):p<=n&&y.push(r(f,c,n)):(y.push(f),p<t?(y.push(r(f,c,t)),s||(y=i(u,y,m,d))):p>n&&(y.push(r(f,c,n)),s||(y=i(u,y,m,d))));(h=(f=g[v-1])[o])>=t&&h<=n&&y.push(f),s&&y[0]!==y[y.length-1]&&y.push(y[0]),i(u,y,m,d)}return u}function i(e,t,n,o){return t.length&&(t.area=n,t.dist=o,e.push(t)),[]}t.exports=function(e,t,n,i,s,u){n/=t,i/=t;for(var l=[],f=0;f<e.length;f++){var a,h,p=e[f],c=p.geometry,g=p.type;if(p.min){if(a=p.min[s],h=p.max[s],a>=n&&h<=i){l.push(p);continue}if(a>i||h<n)continue}var m=1===g?o(c,n,i,s):r(c,n,i,s,u,3===g);m.length&&l.push({geometry:m,type:g,tags:e[f].tags||null})}return l.length?l:null}},{}],2:[function(e,t,n){"use strict";t.exports=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var o=0;o<e.features.length;o++)r(n,e.features[o],t);else"Feature"===e.type?r(n,e,t):r(n,{geometry:e},t);return n};var o=e("./simplify");function r(e,t,n){var o,l,f,a=t.geometry,h=a.type,p=a.coordinates,c=t.properties;if("Point"===h)e.push(i(c,1,[u(p)]));else if("MultiPoint"===h)e.push(i(c,1,s(p)));else if("LineString"===h)e.push(i(c,2,[s(p,n)]));else if("MultiLineString"===h||"Polygon"===h){for(f=[],o=0;o<p.length;o++)f.push(s(p[o],n));e.push(i(c,"Polygon"===h?3:2,f))}else if("MultiPolygon"===h){for(f=[],o=0;o<p.length;o++)for(l=0;l<p[o].length;l++)f.push(s(p[o][l],n));e.push(i(c,3,f))}else if("GeometryCollection"===h)for(o=0;o<a.geometries.length;o++)r(e,{geometry:a.geometries[o],properties:c},n);else console.warn("Unsupported GeoJSON type: "+a.type)}function i(e,t,n){var o={geometry:n,type:t,tags:e||null,min:[1,1],max:[0,0]};return function(e){var t=e.geometry,n=e.min,o=e.max;if(1===e.type)l(n,o,t);else for(var r=0;r<t.length;r++)l(n,o,t[r])}(o),o}function s(e,t){for(var n=[],r=0;r<e.length;r++)n.push(u(e[r]));return t&&(o(n,t),function(e){for(var t,n,o=0,r=0,i=0;i<e.length-1;i++)t=n||e[i],n=e[i+1],o+=t[0]*n[1]-n[0]*t[1],r+=Math.abs(n[0]-t[0])+Math.abs(n[1]-t[1]);e.area=Math.abs(o/2),e.dist=r}(n)),n}function u(e){var t=Math.sin(e[1]*Math.PI/180);return[e[0]/360+.5,.5-.25*Math.log((1+t)/(1-t))/Math.PI,0]}function l(e,t,n){for(var o,r=0;r<n.length;r++)o=n[r],e[0]=Math.min(o[0],e[0]),t[0]=Math.max(o[0],t[0]),e[1]=Math.min(o[1],e[1]),t[1]=Math.max(o[1],t[1])}},{"./simplify":4}],3:[function(e,t,n){"use strict";t.exports=function(e,t){return new s(e,t)};var o=e("./convert"),r=e("./clip"),i=e("./tile");function s(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;n&&console.time("preprocess data");var r=1<<t.maxZoom,i=o(e,t.tolerance/(r*t.extent));this.tiles={},n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),this.splitTile(i,0,0,0),n&&(console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function u(e,t){if(!e||e.transformed)return e;var n,o,r,i=e.z2,s=e.x,u=e.y;for(n=0;n<e.features.length;n++){var f=e.features[n],a=f.geometry;if(1===f.type)for(o=0;o<a.length;o++)a[o]=l(a[o],t,i,s,u);else for(o=0;o<a.length;o++){var h=a[o];for(r=0;r<h.length;r++)h[r]=l(h[r],t,i,s,u)}}return e.transformed=!0,e}function l(e,t,n,o,r){return[Math.round(t*(e[0]*n-o)),Math.round(t*(e[1]*n-r))]}function f(e,t,n){if(1!==e.length)return!1;var o=e[0];if(3!==o.type||o.geometry.length>1)return!1;for(var r=0;r<o.geometry[0].length;r++){var i=o.geometry[0][r];if(i[0]!==-n&&i[0]!==t+n||i[1]!==-n&&i[1]!==t+n)return!1}return!0}function a(e,t,n){return 32*((1<<e)*n+t)+e}function h(e,t,n){return[n,(n-e[0])*(t[1]-e[1])/(t[0]-e[0])+e[1],1]}function p(e,t,n){return[(n-e[1])*(t[0]-e[0])/(t[1]-e[1])+e[0],n,1]}s.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,debug:0},s.prototype.splitTile=function(e,t,n,o,s,u,l){for(var c=[e,t,n,o],g=this.options,m=g.debug,d=g.extent,v=g.buffer;c.length;){e=c.shift();var y=1<<(t=c.shift()),x=a(t,n=c.shift(),o=c.shift()),M=this.tiles[x],P=t===g.maxZoom?0:g.tolerance/(y*d);if(!M&&(m>1&&console.time("creation"),M=this.tiles[x]=i(e,y,n,o,P,t===g.maxZoom),m)){m>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,o,M.numFeatures,M.numPoints,M.numSimplified),console.timeEnd("creation"));var b="z"+t;this.stats[b]=(this.stats[b]||0)+1,this.total++}if(M.source=e,!f(M.features,d,v)){if(s){if(t===g.maxZoom||t===s)continue;var w=1<<s-t;if(n!==Math.floor(u/w)&&o!==Math.floor(l/w))continue}else if(t===g.indexMaxZoom||M.numPoints<=g.indexMaxPoints)continue;M.source=null,m>1&&console.time("clipping");var Z,S,E,F,z,O,T=.5*v/d,q=.5-T,N=.5+T,j=1+T;Z=S=E=F=null,z=r(e,y,n-T,n+N,0,h),O=r(e,y,n+q,n+j,0,h),z&&(Z=r(z,y,o-T,o+N,1,p),S=r(z,y,o+q,o+j,1,p)),O&&(E=r(O,y,o-T,o+N,1,p),F=r(O,y,o+q,o+j,1,p)),m>1&&console.timeEnd("clipping"),Z&&c.push(Z,t+1,2*n,2*o),S&&c.push(S,t+1,2*n,2*o+1),E&&c.push(E,t+1,2*n+1,2*o),F&&c.push(F,t+1,2*n+1,2*o+1)}}},s.prototype.getTile=function(e,t,n){var o=this.options,r=o.extent,i=o.debug,s=a(e,t,n);if(this.tiles[s])return u(this.tiles[s],r);i>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var l,h=e,p=t,c=n;!l&&h>0;)h--,p=Math.floor(p/2),c=Math.floor(c/2),l=this.tiles[a(h,p,c)];if(i>1&&console.log("found parent tile z%d-%d-%d",h,p,c),l&&l.source){if(f(l.features,o.extent,o.buffer))return u(l,r);i>1&&console.time("drilling down"),this.splitTile(l.source,h,p,c,e,t,n),i>1&&console.timeEnd("drilling down")}return u(this.tiles[s],r)}},{"./clip":1,"./convert":2,"./tile":5}],4:[function(e,t,n){"use strict";function o(e,t,n){var o=t[0],r=t[1],i=n[0],s=n[1],u=e[0],l=e[1],f=i-o,a=s-r;if(0!==f||0!==a){var h=((u-o)*f+(l-r)*a)/(f*f+a*a);h>1?(o=i,r=s):h>0&&(o+=f*h,r+=a*h)}return(f=u-o)*f+(a=l-r)*a}t.exports=function(e,t){var n,r,i,s,u=t*t,l=e.length,f=0,a=l-1,h=[];e[f][2]=1,e[a][2]=1;for(;a;){for(r=0,n=f+1;n<a;n++)(i=o(e[n],e[f],e[a]))>r&&(s=n,r=i);r>u?(e[s][2]=r,h.push(f),h.push(s),f=s):(a=h.pop(),f=h.pop())}}},{}],5:[function(e,t,n){"use strict";function o(e,t,n,o){var r,i,s,u,l=t.geometry,f=t.type,a=[],h=n*n;if(1===f)for(r=0;r<l.length;r++)a.push(l[r]),e.numPoints++,e.numSimplified++;else for(r=0;r<l.length;r++)if(s=l[r],o||!(2===f&&s.dist<n||3===f&&s.area<h)){var p=[];for(i=0;i<s.length;i++)u=s[i],(o||u[2]>h)&&(p.push(u),e.numSimplified++),e.numPoints++;a.push(p)}else e.numPoints+=s.length;a.length&&e.features.push({geometry:a,type:f,tags:t.tags||null})}t.exports=function(e,t,n,r,i,s){for(var u={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z2:t,transformed:!1},l=0;l<e.length;l++)u.numFeatures++,o(u,e[l],i,s);return u}},{}]},{},[3])(3)});